# Enbon 综合管理后台系统 - 架构文档

## 项目概述

**项目名称**: Enbon Unified Management Platform (Enbon综合管理后台系统)

**公司**: Enbon.com - LED显示屏外贸公司

**目标**: 整合文件存储、业务系统（小满CRM、金蝶财务、飞书等），统一办公入口，提高工作效率

---

## 一、业务需求分析

### 1.1 核心痛点
- 多系统分散：金蝶、小满、飞书、共享盘各自独立
- 文件传输繁琐：需要百度网盘等中转
- 数据孤岛：各部门数据不互通
- 权限管理混乱：共享盘权限不清晰
- **文件查找困难**：在海量文件中寻找特定文档耗时费力
- **重复性工作**：报价单、合同等文档需要重复填写，效率低下

### 1.2 解决方案
- **统一存储中心**：基于本地服务器的部门级文件系统
- **统一工作入口**：一个后台管理所有业务系统
- **API集成中心**：接入第三方系统，数据互通
- **权限管控体系**：精细化的角色权限管理
- **AI智能搜索**：结合DeepSeek等AI，自然语言搜索文件
- **智能工作流**：一键生成报价单、合同等常用文档

---

## 二、系统架构设计

### 2.1 整体架构

```
┌─────────────────────────────────────────────────┐
│             前端管理系统 (Web)                     │
│         Vue3 + Element Plus / Ant Design         │
└─────────────────────────────────────────────────┘
                        ↕
┌─────────────────────────────────────────────────┐
│             后端API服务层                         │
│         Node.js + Express / NestJS              │
│  - 用户认证授权  - 文件管理  - 权限控制          │
│  - API网关      - 业务逻辑  - 数据同步           │
│  - AI智能服务   - 工作流引擎 - 文档生成          │
└─────────────────────────────────────────────────┘
      ↕                    ↕                    ↕
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ 文件存储系统   │  │  数据库系统    │  │  API接口层   │
│              │  │              │  │              │
│ 企划部 10T   │  │  MySQL/      │  │  小满CRM    │
│ 销售部 10T   │  │  MongoDB     │  │  金蝶财务    │
│ 技术部 10T   │  │  缓存:Redis   │  │  飞书协作    │
│ 财务部 5T    │  │  搜索引擎    │  │  DeepSeek AI │
│ 人事行政 5T  │  │  - 文件索引  │  │  其他系统    │
│ 公共区域 10T │  │  - 内容检索  │  │              │
└──────────────┘  └──────────────┘  └──────────────┘
```

### 2.2 技术栈选型

#### 前端
- **框架**: Vue 3 + TypeScript
- **UI组件**: Element Plus / Ant Design Vue
- **状态管理**: Pinia
- **路由**: Vue Router
- **构建工具**: Vite

#### 后端
- **语言**: Node.js + TypeScript
- **框架**: NestJS (推荐) 或 Express
- **ORM**: TypeORM / Prisma
- **认证**: JWT + Redis Session
- **文件上传**: multer / formidable

#### 数据库
- **关系型**: PostgreSQL / MySQL 8.0
- **NoSQL**: MongoDB (日志/审计)
- **缓存**: Redis (会话/缓存)
- **全文搜索**: Elasticsearch (可选)

#### 文件存储
- **本地存储**: 直接访问服务器硬盘分区
- **文件系统**: Node.js fs模块 / formidable
- **备份**: 定期增量备份到云存储

#### 第三方集成
- **小满CRM**: REST API / 爬虫(无API时)
- **金蝶云**: 开放平台API
- **飞书**: 开放平台API
- **钉钉/企业微信**: 开放平台API

#### AI智能服务
- **DeepSeek API**: 自然语言理解、智能搜索
- **OpenAI GPT**: 可选，文档生成辅助
- **百度AI/阿里云AI**: 备用AI服务
- **向量数据库**: 用于语义搜索（可选 Milvus/Pinecone）

---

## 三、功能模块设计

### 3.1 文件管理系统

#### 部门存储空间
```
/public              (公共区域 - 10T)
├─ /documents        # 公司文档
├─ /templates        # 模板库
└─ /shared           # 共享文件

/department/planning  (企划部 - 10T)
├─ /projects         # 项目文件
├─ /designs          # 设计方案
└─ /assets           # 素材库

/department/sales     (销售部 - 10T)
├─ /orders           # 订单文档
├─ /contracts        # 合同文件
└─ /customers        # 客户资料

/department/tech      (技术部 - 10T)
├─ /projects         # 项目代码
├─ /docs             # 技术文档
└─ /testing          # 测试文件

/department/finance   (财务部 - 5T)
├─ /reports          # 财务报表
├─ /invoices         # 发票存档
└─ /payroll          # 薪资文件

/department/hr        (人事行政 - 5T)
├─ /employees        # 员工档案
├─ /assets           # 资产登记
└─ /inventory        # 库存管理
```

#### 核心功能
- ✅ 文件上传/下载（支持断点续传）
- ✅ 在线预览（Office、PDF、图片、视频）
- ✅ 文件夹管理（创建/重命名/移动/删除）
- ✅ 文件搜索（全文检索）
- ✅ 版本控制（文件历史版本）
- ✅ 共享链接（生成临时访问链接）
- ✅ 访问日志（操作记录审计）
- ✅ 容量监控（使用量预警）
- ✅ **AI智能搜索**（结合DeepSeek的自然语言检索）

### 3.2 权限管理系统

#### 角色定义
```
- 超级管理员 (Super Admin)
  - 所有权限，系统配置

- 部门负责人 (Department Head)
  - 管理本部门文件
  - 查看部门成员操作

- 普通员工 (Employee)
  - 访问授权文件
  - 编辑本人文件

- 财务人员 (Finance)
  - 财务部门文件
  - 财务报表查看

- 人事行政 (HR)
  - 人事文件管理
  - 资产登记管理

- 访客 (Guest)
  - 只读权限
  - 指定文件访问
```

#### 权限控制
- 基于RBAC（角色权限控制）
- 文件夹级权限继承
- 文件级细粒度控制
- 支持临时授权

### 3.3 业务系统集成

#### 小满CRM集成
```
功能模块:
├─ 客户管理
│   ├─ 客户列表同步
│   ├─ 联系记录查看
│   └─ 商机跟进
├─ 订单管理
│   ├─ 订单列表
│   ├─ 订单详情
│   └─ 合同关联
└─ 销售报表
    ├─ 业绩统计
    └─ 数据分析
```

#### 金蝶财务集成
```
功能模块:
├─ 财务报表
│   ├─ 资产负债表
│   ├─ 利润表
│   └─ 现金流量表
├─ 发票管理
│   ├─ 进项发票
│   ├─ 销项发票
│   └─ 发票查验
└─ 成本核算
    ├─ 成本分析
    └─ 预算管理
```

#### 飞书协作集成
```
功能模块:
├─ 消息通知
│   ├─ 系统消息推送到飞书
│   └─ 审批消息提醒
├─ 审批流程
│   ├─ 请假申请
│   ├─ 报销审批
│   └─ 用印申请
└─ 日程管理
    ├─ 会议提醒
    └─ 任务分配
```

### 3.4 人事行政模块

#### 人事管理
- 员工档案管理
- 考勤打卡（对接打卡机/飞书）
- 请假审批流程
- 薪资管理（基础信息）

#### 资产管理
- 固定资产登记
- 资产盘点
- 资产借用/归还
- 资产报废流程

#### 库存管理
- 物料入库/出库
- 库存查询
- 库存预警
- 采购申请

### 3.5 AI智能搜索模块

#### 智能文件搜索
```
核心功能:
├─ 自然语言搜索
│   ├─ 语音转文字搜索
│   ├─ 语义理解（"我要找P5显示屏的产品图"）
│   └─ 模糊匹配建议
├─ 文件内容分析
│   ├─ PDF内容提取与索引
│   ├─ 图片OCR识别（规格书中的参数）
│   ├─ Office文档内容提取
│   └─ 文件标签自动生成
├─ 智能推荐
│   ├─ 关联文件推荐
│   ├─ 最近使用文件
│   └─ 部门热点文档
└─ 搜索结果优化
    ├─ 结果排序（相关度）
    ├─ 结果分组（按类型/部门）
    └─ 预览快速查看
```

#### 技术实现
- **向量化搜索**: 使用embedding模型将文件内容转化为向量
- **语义理解**: DeepSeek API处理用户自然语言查询
- **内容索引**: 建立文件内容全文索引库
- **缓存机制**: 常用搜索结果缓存，提升响应速度

#### 应用场景
- 搜索产品规格书："找P4显示屏的规格书和图片"
- 查找合同文档："显示与XXX公司的合同"
- 匹配历史报价："相似产品的历史报价单"
- 跨部门搜索："财务部的2024年报表"

### 3.6 智能工作流模块

#### 文档生成工作流
```
工作流模板:
├─ 销售报价单
│   ├─ 输入: 客户信息、产品型号、数量、价格
│   ├─ 自动填充: 公司信息、联系方式、条款
│   ├─ 格式: 标准报价单模板
│   └─ 输出: PDF/Excel可编辑文档
├─ 产品合同
│   ├─ 输入: 客户信息、产品清单、金额
│   ├─ 自动生成: 合同条款、交付日期、质保
│   └─ 输出: Word/PDF合同文档
├─ 订单确认单
│   ├─ 输入: 订单号、产品信息
│   ├─ 关联: 自动关联客户信息、历史订单
│   └─ 输出: 确认单文档
└─ 自定义模板
    ├─ 自定义字段
    ├─ 自定义格式
    └─ 保存为模板
```

#### 工作流引擎
- **模板管理**: 创建、编辑、复用模板
- **数据绑定**: 自动从系统数据库获取信息
- **格式化**: 自动排版、样式设置
- **批量生成**: 支持批量处理多份文档
- **审批流程**: 生成后自动触发审批流程

#### 技术实现
- **模板引擎**: 使用Handlebars/模板引擎
- **AI辅助**: DeepSeek优化文案、条款建议
- **文档渲染**: PDF.js / docx库生成文档
- **版本管理**: 模板版本控制

### 3.7 其他功能模块

#### 数据看板
- 各部门存储使用情况
- 系统使用统计
- 业务数据汇总
- **AI搜索使用统计**
- **工作流使用效率**

#### 系统监控
- 服务器性能监控
- 磁盘空间预警
- 系统日志审计
- **AI API调用监控**

#### 备份策略
- 每日增量备份
- 每周全量备份
- 云端备份（阿里云OSS/腾讯云COS）

---

## 四、服务器配置建议

### 4.1 硬件配置
```
CPU: Intel i7-12700 / AMD Ryzen 7 5700X 或更高
内存: 32GB DDR4
硬盘: 
  - 系统盘: 500GB SSD (NVMe)
  - 数据盘: 8块 8TB HDD (RAID 10，总容量约30TB)
  或
  - 单块 50TB 企业级HDD
网卡: 千兆网卡

预估成本: 1.5-2万元
```

### 4.2 操作系统
- Linux: Ubuntu Server 22.04 LTS (推荐)
- Windows: Windows Server 2022 (可选)

### 4.3 部署方案
```
服务器 → Docker容器化部署
├─ Nginx (反向代理/负载均衡)
├─ 后端API服务
├─ MySQL/PostgreSQL
├─ Redis
├─ MongoDB (可选)
└─ 定时备份服务
```

---

## 五、开发计划

### 5.1 开发阶段

#### 第一阶段 (2-3周): 基础框架
- ✅ 前后端项目搭建
- ✅ 用户认证系统
- ✅ 权限管理系统
- ✅ 基础文件管理

#### 第二阶段 (3-4周): 核心功能
- ✅ 文件上传/下载
- ✅ 文件夹管理
- ✅ 文件预览
- ✅ 部门权限控制

#### 第三阶段 (2-3周): 系统集成
- ✅ 小满CRM对接
- ✅ 金蝶API对接
- ✅ 飞书API对接
- ✅ 数据同步机制

#### 第四阶段 (2-3周): 扩展功能
- ✅ 人事管理
- ✅ 资产管理
- ✅ 库存管理
- ✅ 数据看板

#### 第五阶段 (2-3周): AI智能功能
- ✅ AI智能搜索开发
- ✅ DeepSeek API集成
- ✅ 文件内容索引系统
- ✅ 智能工作流引擎
- ✅ 文档模板系统

#### 第六阶段 (1-2周): 测试优化
- ✅ 功能测试
- ✅ 性能优化
- ✅ 安全加固
- ✅ 用户培训

**总预计时间**: 12-17周

### 5.2 技术难点

1. **大文件上传**
   - 方案: 分片上传 + 断点续传
   - 前端: axios + 分片
   - 后端: multipart/form-data处理

2. **文件在线预览**
   - Office: 转PDF后预览
   - PDF: pdf.js
   - 图片/视频: 直接预览

3. **第三方API集成**
   - 可能需要爬虫方案（无官方API时）
   - Token刷新机制
   - 数据缓存策略

4. **存储容量管理**
   - 定期扫描统计
   - 容量预警机制
   - 自动清理策略

5. **AI智能搜索**
   - 文件内容向量化存储
   - 语义搜索准确性优化
   - AI API调用成本控制
   - 搜索响应时间优化

6. **文档自动生成**
   - 模板引擎设计
   - 数据自动填充准确性
   - PDF生成性能
   - 多格式支持

---

## 六、安全方案

### 6.1 认证安全
- JWT Token认证
- Token刷新机制
- IP白名单（可选）
- 登录失败锁定

### 6.2 数据安全
- 数据库加密
- 传输加密（HTTPS）
- 文件权限控制
- 操作日志审计

### 6.3 备份策略
- 每日增量备份
- 每周全量备份
- 云端异地备份
- 灾难恢复预案

---

## 七、预期效果

### 7.1 效率提升
- **统一入口**: 减少系统切换
- **文件集中**: 无需多平台传输
- **数据互通**: 业务系统整合
- **权限清晰**: 数据安全可控
- **AI智能搜索**: 文件查找效率提升80%+
- **文档自动生成**: 报价单等文档生成时间从30分钟缩短至2分钟

### 7.2 成本控制
- **初期投入**: 服务器硬件 1.5-2万
- **开发成本**: 自研或外包 4-6万（含AI功能）
- **后期维护**: 电费+网络约500-1000/月
- **AI API费用**: DeepSeek约500-2000/月（按使用量）
- **总拥有成本**: 仍远低于云存储+多个SaaS订阅方案

### 7.3 扩展性
- 模块化设计，易于扩展
- 支持二次开发
- 可对接更多第三方系统
- 逐步完善功能

---

## 八、风险评估

### 8.1 技术风险
- ✅ **API对接困难**: 部分系统可能无开放API → 爬虫方案
- ✅ **大文件处理**: 服务器带宽限制 → 优化上传策略
- ✅ **数据同步**: 第三方数据同步延迟 → 缓存+轮询

### 8.2 业务风险
- ⚠️ **数据迁移**: 现有数据迁移量大 → 分批迁移
- ⚠️ **用户接受度**: 改变工作习惯 → 充分培训
- ⚠️ **维护成本**: 需要专人维护 → 培训内部人员

### 8.3 应对措施
- 充分的技术调研
- 分阶段实施
- 保留原系统做双轨运行
- 建立完善的文档体系

---

## 九、总结

这个项目**完全可以实现**，且具有以下优势：

1. **技术成熟**: 所有技术栈都是成熟方案
2. **成本可控**: 相比云存储长期更经济
3. **数据安全**: 数据掌握在自己手中
4. **高度定制**: 完全按需求开发
5. **持续迭代**: 可不断优化和扩展

建议优先开发核心的文件管理系统和权限体系，然后再逐步集成第三方系统和扩展功能。

---

## 附录

### A. 相关文档
- API接口文档（待补充）
- 数据库设计文档（待补充）
- 部署运维文档（待补充）

### B. 联系信息
- 项目负责人: [待填写]
- 技术负责人: [待填写]
- 开发团队: [待填写]

---

**文档版本**: v2.0  
**创建日期**: 2024年  
**最后更新**: 2024年12月  
**更新内容**: 
- 新增AI智能搜索功能模块
- 新增智能工作流（文档自动生成）功能
- 集成DeepSeek AI API
- 优化架构设计和技术栈
- 更新开发计划和成本估算
